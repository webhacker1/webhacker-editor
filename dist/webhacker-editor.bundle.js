!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebHackerEditor=t():e.WebHackerEditor=t()}(self,()=>(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var a={},i=[],l=0;l<e.length;l++){var c=e[l],s=o.base?c[0]+o.base:c[0],d=a[s]||0,p="".concat(s," ").concat(d);a[s]=d+1;var u=n(p),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var b=r(h,o);o.byIndex=l,t.splice(l,0,{identifier:p,updater:b,references:1})}i.push(p)}return i}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var a=o(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var l=n(a[i]);t[l].references--}for(var c=o(e,r),s=0;s<a.length;s++){var d=n(a[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var l=0;l<this.length;l++){var c=this[l][0];null!=c&&(i[c]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&i[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},584:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),r=n.n(o),a=n(314),i=n.n(a)()(r());i.push([e.id,':root {\n    --border-color: #e5e9f1;\n    --text-color: #0b1220;\n    --muted-color: #6b7280;\n    --accent-color: #2563eb;\n    --background-color: #f3f6fb;\n    --table-line: #afb0b3;\n}\n\n* {\n    box-sizing: border-box;\n}\n\n.webhacker-editor {\n    position: relative;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 14px;\n    overflow: hidden;\n    color: var(--text-color);\n}\n\n.webhacker-toolbar {\n    display: flex;\n    gap: 8px;\n    padding: 10px;\n    background: var(--background-color);\n    border-bottom: 1px solid var(--border-color);\n    align-items: center;\n    flex-wrap: wrap;\n    color: var(--text-color);\n}\n\n.webhacker-toolbar__group {\n    display: flex;\n    gap: 6px;\n    align-items: center;\n}\n\n.webhacker-toolbar__separator {\n    width: 1px;\n    height: 24px;\n    background: var(--border-color);\n}\n\n.webhacker-button {\n    appearance: none;\n    border: 1px solid var(--border-color);\n    background: var(--background-color);\n    color: var(--text-color);\n    padding: 6px 8px;\n    border-radius: 10px;\n    cursor: pointer;\n}\n.webhacker-button:hover {\n    background: var(--background-color);\n}\n.webhacker-button[aria-pressed="true"] {\n    outline: 2px solid var(--accent-color);\n    outline-offset: 1px;\n}\n.webhacker-button--primary,\n.webhacker-button--primary:hover {\n    background: var(--accent-color);\n    border-color: transparent;\n    color: #fff;\n}\n.webhacker-button--ghost {\n    background: transparent;\n}\n\n.webhacker-button[disabled],\n.webhacker-button[aria-disabled="true"] {\n    cursor: not-allowed;\n    position: relative;\n}\n\n.webhacker-button[disabled] > i,\n.webhacker-button[aria-disabled="true"] > i {\n    opacity: 0.5;\n}\n\n.webhacker-button[disabled]:hover,\n.webhacker-button[aria-disabled="true"]:hover {\n    background: var(--background-color);\n}\n.webhacker-button[aria-disabled="true"]::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    top: calc(100% + 6px);\n    left: 50%;\n    transform: translateX(-50%);\n    background: #1e2251;\n    color: #fff;\n    padding: 4px 6px;\n    border-radius: 6px;\n    font-size: 12px;\n    white-space: nowrap;\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.15s ease;\n    z-index: 30;\n}\n.webhacker-button[aria-disabled="true"]:hover::after {\n    opacity: 1;\n}\n\n.webhacker-dropdown {\n    position: relative;\n}\n\n.webhacker-menu {\n    position: absolute;\n    top: 40px;\n    left: 0;\n    min-width: 240px;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 12px;\n    padding: 8px;\n    z-index: 20;\n    color: var(--text-color);\n}\n.webhacker-menu--hidden {\n    display: none;\n}\n.webhacker-menu__item {\n    padding: 8px 10px;\n    border-radius: 8px;\n    cursor: pointer;\n}\n.webhacker-menu__item:hover {\n    background: var(--background-color);\n}\n\n.webhacker-content {\n    min-height: 320px;\n    padding: 18px;\n    outline: none;\n    color: var(--text-color);\n}\n.webhacker-content:empty:before {\n    content: attr(data-placeholder);\n    color: var(--muted-color);\n}\n\n.webhacker-content p {\n    margin: 0 0 10px;\n}\n\n.webhacker-content a {\n    color: var(--accent-color);\n    text-decoration: none;\n    border-bottom: 1px solid rgba(37, 99, 235, 0.35);\n}\n.webhacker-content a:hover {\n    border-bottom-color: currentColor;\n}\n\n.webhacker-content strong,\n.webhacker-content b {\n    font-weight: 700;\n}\n.webhacker-content em,\n.webhacker-content i {\n    font-style: italic;\n}\n.webhacker-content u {\n    text-decoration: underline;\n}\n\n.webhacker-content img {\n    max-width: 100%;\n    border-radius: 10px;\n    display: block;\n    height: auto;\n    margin: 12px 0;\n}\n\n.webhacker-content h1,\n.webhacker-content h2,\n.webhacker-content h3,\n.webhacker-content h4,\n.webhacker-content h5,\n.webhacker-content h6 {\n    line-height: 1.25;\n    font-weight: 700;\n    color: var(--text-color);\n}\n.webhacker-content h1 {\n    font-size: 32px;\n    letter-spacing: -0.01em;\n}\n.webhacker-content h2 {\n    font-size: 26px;\n}\n.webhacker-content h3 {\n    font-size: 22px;\n}\n.webhacker-content h4 {\n    font-size: 18px;\n}\n.webhacker-content h5 {\n    font-size: 16px;\n}\n.webhacker-content h6 {\n    font-size: 14px;\n    color: var(--muted-color);\n    text-transform: uppercase;\n    letter-spacing: 0.06em;\n}\n\n.webhacker-content ul,\n.webhacker-content ol {\n    margin: 0 0 1em 1.4em;\n    padding: 0;\n}\n.webhacker-content li {\n    margin: 0.3em 0;\n}\n\n.webhacker-content blockquote {\n    margin: 1.2em 0;\n    padding: 0.6em 0.9em 0.6em 1em;\n    background: #f8fafc;\n    border-left: 4px solid #cbd5e1;\n    border-radius: 8px;\n    color: #334155;\n}\n\n.webhacker-color {\n    display: grid;\n    gap: 10px;\n}\n.webhacker-color__swatches {\n    display: grid;\n    grid-template-columns: repeat(10, 18px);\n    gap: 6px;\n}\n.webhacker-swatch {\n    width: 18px;\n    height: 18px;\n    border-radius: 4px;\n    border: 1px solid var(--border-color);\n    cursor: pointer;\n}\n.webhacker-swatch[aria-selected="true"] {\n    outline: 2px solid var(--accent-color);\n}\n\n.webhacker-input,\n.webhacker-file {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    background: var(--background-color);\n    color: var(--text-color);\n}\n\n.webhacker-form {\n    display: grid;\n    gap: 8px;\n}\n.webhacker-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n}\n\n.webhacker-tablepick {\n    display: grid;\n    gap: 8px;\n}\n.webhacker-tablepick__label {\n    font-size: 12px;\n    color: var(--muted-color);\n    text-align: right;\n}\n.webhacker-tablepick__grid {\n    display: grid;\n    grid-template-columns: repeat(10, 18px);\n    gap: 6px;\n}\n.webhacker-tablepick__cell {\n    width: 18px;\n    height: 18px;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    background: var(--background-color);\n    padding: 0;\n    cursor: pointer;\n}\n.webhacker-tablepick__cell.is-selected {\n    background: var(--accent-color);\n    border-color: var(--accent-color);\n}\n\n.webhacker-badge--beta {\n    display: inline-block;\n    margin-left: 6px;\n    padding: 4px 8px;\n    font-size: 0.8rem;\n    border-radius: 4px;\n    background: #fea530;\n    color: #fff;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.wh-table {\n    display: inline-table;\n    border-collapse: separate;\n    border-spacing: 0;\n    background: var(--background-color);\n    color: var(--text-color);\n    border: 2px solid var(--table-line);\n    border-radius: 10px;\n    overflow: hidden;\n    margin: 16px auto;\n    max-width: 100%;\n}\n.wh-table th,\n.wh-table td {\n    padding: 10px 14px;\n    vertical-align: top;\n    border-right: 1px solid var(--table-line);\n    border-bottom: 1px solid var(--table-line);\n    word-break: break-word;\n}\n.wh-table thead th {\n    font-weight: 600;\n    border-bottom: 2px solid var(--table-line);\n}\n.wh-table th:last-child,\n.wh-table td:last-child {\n    border-right: 0;\n}\n.wh-table tr:last-child td {\n    border-bottom: 0;\n}\n.wh-table + .wh-table {\n    margin-top: 20px;\n}\n\n.webhacker-button[data-tooltip] {\n    position: relative;\n}\n.webhacker-button[data-tooltip]:not([aria-disabled="true"])::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    top: calc(100% + 6px);\n    left: 50%;\n    transform: translate(-50%, -4px);\n    background: #1e2251;\n    color: #fff;\n    padding: 4px 6px;\n    border-radius: 6px;\n    font-size: 12px;\n    white-space: nowrap;\n    opacity: 0;\n    pointer-events: none;\n    transition:\n        opacity 0.15s ease,\n        transform 0.15s ease;\n    z-index: 30;\n}\n.webhacker-button[data-tooltip]:hover::after,\n.webhacker-button[data-tooltip]:focus-visible::after {\n    opacity: 1;\n    transform: translate(-50%, 0);\n}\n',""]);const l=i},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={id:o,exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var o={};n.r(o),n.d(o,{default:()=>O,sanitizeHtmlStringToSafeHtml:()=>T});var r=n(72),a=n.n(r),i=n(825),l=n.n(i),c=n(659),s=n.n(c),d=n(56),p=n.n(d),u=n(540),h=n.n(u),b=n(113),g=n.n(b),f=n(584),m={};function w(e,t,n){const o=document.createElement(e);return t&&(o.className=t),n&&Object.entries(n).forEach(([e,t])=>o.setAttribute(e,t)),o}m.styleTagTransform=g(),m.setAttributes=p(),m.insert=s().bind(null,"head"),m.domAPI=l(),m.insertStyleElement=h(),a()(f.A,m),f.A&&f.A.locals&&f.A.locals;const v=new Set(["p","br","hr","strong","b","em","i","u","mark","small","sub","sup","span","font","a","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","figure","figcaption","dl","dt","dd","img","table","thead","tbody","tr","th","td","div"]),k=["wh-table"];function y(e){return String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}function x(e){const t=String(e||"").trim();if(/^(https?:|mailto:|tel:|data:image\/)/i.test(t))return t;const n=t.replace(/^[a-zA-Z][\w+.-]*:/,"");return n?"https://"+n:"https://"}function E(e){const t=String(e||"").trim();if(/^#([0-9a-fA-F]{3}){1,2}$/.test(t))return 4===t.length?("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toUpperCase():t.toUpperCase();const n=t.match(/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*[\d.]+\s*)?\)$/);if(n){const e=e=>Math.max(0,Math.min(255,parseInt(e,10))),t=t=>e(t).toString(16).padStart(2,"0");return("#"+t(n[1])+t(n[2])+t(n[3])).toUpperCase()}return null}function C(e,t={}){if(!e.hasAttribute("style"))return;const n=!!t.stripColors,o=e.tagName.toLowerCase(),r=(e.getAttribute("style")||"").split(";").map(e=>e.trim()).filter(Boolean),a=new Set(["p","div","blockquote","li","td","th","h1","h2","h3","h4","h5","h6"]);let i=null,l=null;for(const e of r){const t=e.split(":"),r=t[0]?t[0].trim().toLowerCase():"",c=t[1]?t[1].trim():"";if(!n&&"color"===r&&"span"===o){const e=E(c);e&&(i=e)}if(!/^background(-color)?$/.test(r)&&"text-align"===r&&a.has(o)){const e=c.toLowerCase();"left"!==e&&"right"!==e&&"center"!==e&&"justify"!==e||(l=e)}}const c=[];i&&c.push(`color: ${i}`),l&&c.push(`text-align: ${l}`),c.length?e.setAttribute("style",c.join("; ")):e.removeAttribute("style")}function S(e,t={}){if(e.nodeType!==Node.COMMENT_NODE)if(e.nodeType===Node.ELEMENT_NODE){const n=e.tagName.toLowerCase();if(!v.has(n)){const t=document.createTextNode(e.textContent||"");return void e.replaceWith(t)}!function(e,t={}){[...e.attributes].filter(e=>/^on/i.test(e.name)).forEach(t=>e.removeAttribute(t.name));const n=e.tagName.toLowerCase();e.removeAttribute("id");const o=e.getAttribute("style");if(o){const t=o.split(";").map(e=>e.trim()).filter(e=>e&&!/^font-family\s*:/i.test(e)).join("; ");t?e.setAttribute("style",t):e.removeAttribute("style")}switch(n){case"a":{const n=x(e.getAttribute("href")||"");e.setAttribute("href",n),e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"),[...e.attributes].forEach(t=>{["href","target","rel","style"].includes(t.name)||e.removeAttribute(t.name)}),C(e,t);break}case"img":{const t=x(e.getAttribute("src")||""),n=/^data:image\//i.test(t),o=/^https?:\/\//i.test(t)&&/\.(png|jpe?g|gif|webp|svg)$/i.test(t);if(!n&&!o){e.remove();break}e.setAttribute("src",t);const r=e.getAttribute("alt")||"";e.setAttribute("alt",r),[...e.attributes].forEach(t=>{["src","alt"].includes(t.name)||e.removeAttribute(t.name)});break}case"span":default:C(e,t),[...e.attributes].forEach(t=>{["style"].includes(t.name)||e.removeAttribute(t.name)});break;case"font":{e.removeAttribute("face");const n=t.stripColors?null:E(e.getAttribute("color"));n?e.setAttribute("color",n):e.removeAttribute("color"),[...e.attributes].forEach(t=>{["color"].includes(t.name)||e.removeAttribute(t.name)});break}case"table":{const t=(e.getAttribute("class")||"").split(/\s+/).filter(e=>k.includes(e));t.length?e.setAttribute("class",t.join(" ")):e.removeAttribute("class"),[...e.attributes].forEach(t=>{["class"].includes(t.name)||e.removeAttribute(t.name)});break}case"td":case"th":{const n=(e.getAttribute("class")||"").split(/\s+/).filter(e=>"is-numeric"===e);n.length?e.setAttribute("class",n.join(" ")):e.removeAttribute("class");const o=e.getAttribute("colspan"),r=e.getAttribute("rowspan");[...e.attributes].forEach(t=>{["class","colspan","rowspan","style"].includes(t.name)||e.removeAttribute(t.name)}),o&&!/^\d+$/.test(o)&&e.removeAttribute("colspan"),r&&!/^\d+$/.test(r)&&e.removeAttribute("rowspan"),C(e,t);break}}}(e,t),[...e.childNodes].forEach(e=>S(e,t))}else[...e.childNodes||[]].forEach(e=>S(e,t));else e.remove()}function T(e,t={}){const n=document.createElement("template");return n.innerHTML=String(e||""),S(n.content,t),n.innerHTML}function A(e,t){t&&(t.backgroundColor&&e.style.setProperty("--editor-background",t.backgroundColor),t.textColor&&e.style.setProperty("--text-color",t.textColor))}function L(e,t=null){document.execCommand(e,!1,t)}const _={placeholder:"Начните печатать…",undo:"Отменить",redo:"Повторить",bold:"Жирный",italic:"Курсив",underline:"Подчеркнуть",color:"Цвет текста",link:"Ссылка",image:"Изображение",headings:"Заголовки",table:"Таблица",unorderedList:"Маркированный список",orderedList:"Нумерованный список",alignLeft:"По левому краю",alignCenter:"По центру",alignRight:"По правому краю",beta:"БЕТА",soon:"Скоро",remove:"Удалить",ok:"OK",paragraph:"Абзац",linkPlaceholder:"https://пример.ру",linkTextPlaceholder:"Текст ссылки (необязательно)"},M={placeholder:"Start typing…",undo:"Undo",redo:"Redo",bold:"Bold",italic:"Italic",underline:"Underline",color:"Text color",link:"Link",image:"Image",headings:"Headings",table:"Table",unorderedList:"Bulleted list",orderedList:"Numbered list",alignLeft:"Align left",alignCenter:"Center",alignRight:"Align right",beta:"BETA",soon:"Soon",remove:"Remove",ok:"OK",paragraph:"Paragraph",linkPlaceholder:"https://example.com",linkTextPlaceholder:"Link text (optional)"};function R(e,t={}){if(this.hostContainerElement="string"==typeof e?document.querySelector(e):e,!this.hostContainerElement)throw new Error("WebHackerEditor: контейнер не найден");this.editorOptions=Object.assign({},{language:"ru",placeholderText:null,onChange:null,theme:null},t),this.currentSavedSelectionRange=null,this.trackedToggleButtonsMap={},this.renderEditorInterface(),A(this.editorRootElement,this.editorOptions.theme),this.bindEditorEvents()}R.prototype.getHTML=function(){return T(this.contentEditableElement.innerHTML).trim()},R.prototype.setHTML=function(e){const t=T(e);this.contentEditableElement.innerHTML=t||"",this.syncToggleStates()},R.prototype.renderEditorInterface=function(){const e={ru:_,en:M}[this.editorOptions.language||"ru"],t=w("div","webhacker-editor",{role:"region"}),n=w("div","webhacker-toolbar"),o=w("div","webhacker-toolbar__group");o.append(this.createToolbarButton("fa-solid fa-rotate-left",e.undo,()=>L("undo")),this.createToolbarButton("fa-solid fa-rotate-right",e.redo,()=>L("redo")));const r=w("div","webhacker-toolbar__group");r.append(this.createToolbarButton("fa-solid fa-bold",e.bold,()=>L("bold"),!0,"bold"),this.createToolbarButton("fa-solid fa-italic",e.italic,()=>L("italic"),!0,"italic"),this.createToolbarButton("fa-solid fa-underline",e.underline,()=>L("underline"),!0,"underline"),this.createColorDropdown(),this.createLinkDropdown(),this.createDisabledImageButton());const a=w("div","webhacker-toolbar__group");a.append(this.createHeadingDropdown());const i=w("div","webhacker-toolbar__group");i.append(this.createToolbarButton("fa-solid fa-align-left",e.alignLeft,()=>L("justifyLeft"),!0,"alignLeft"),this.createToolbarButton("fa-solid fa-align-center",e.alignCenter,()=>L("justifyCenter"),!0,"alignCenter"),this.createToolbarButton("fa-solid fa-align-right",e.alignRight,()=>L("justifyRight"),!0,"alignRight"));const l=w("div","webhacker-toolbar__group");l.append(this.createToolbarButton("fa-solid fa-list-ul",e.unorderedList,()=>L("insertUnorderedList"),!0,"unorderedList"),this.createToolbarButton("fa-solid fa-list-ol",e.orderedList,()=>L("insertOrderedList"),!0,"orderedList"),this.createTableDropdown()),n.append(o,this.createSeparator(),r,this.createSeparator(),a,this.createSeparator(),i,this.createSeparator(),l);const c=w("span","webhacker-badge--beta",{title:e.soon});c.textContent=e.beta,n.append(c);const s=w("div","webhacker-content",{contenteditable:"true"});s.setAttribute("data-placeholder",this.editorOptions.placeholderText||e.placeholder),t.append(n,s),this.hostContainerElement.appendChild(t),this.editorRootElement=t,this.toolbarElement=n,this.contentEditableElement=s},R.prototype.toggleMenu=function(e){this.closeAllMenus(e),e.classList.toggle("webhacker-menu--hidden");const t=n=>{e.contains(n.target)||(this.closeAllMenus(),document.removeEventListener("mousedown",t,!0))};document.addEventListener("mousedown",t,!0)},R.prototype.closeAllMenus=function(e){this.editorRootElement.querySelectorAll(".webhacker-menu").forEach(t=>{t!==e&&t.classList.add("webhacker-menu--hidden")})},R.prototype.emitChange=function(){"function"==typeof this.editorOptions.onChange&&this.editorOptions.onChange(this.getHTML())},R.prototype.syncToggleStates=function(){const e=e=>String(document.queryCommandState(e)),t=(e,t)=>{this.trackedToggleButtonsMap[e]&&this.trackedToggleButtonsMap[e].setAttribute("aria-pressed",t)};t("bold",e("bold")),t("italic",e("italic")),t("underline",e("underline")),t("unorderedList",e("insertUnorderedList")),t("orderedList",e("insertOrderedList")),t("alignLeft",e("justifyLeft")),t("alignCenter",e("justifyCenter")),t("alignRight",e("justifyRight"))},R.prototype.saveSelectionRange=function(){const e=window.getSelection();return e&&0!==e.rangeCount?e.getRangeAt(0).cloneRange():null},R.prototype.restoreSelectionRange=function(e){if(!e)return;const t=window.getSelection();t.removeAllRanges(),t.addRange(e)},R.prototype.setTheme=function(e){A(this.editorRootElement,e||null)};const D={ru:_,en:M};R.prototype.createDisabledImageButton=function(){const e=this.editorOptions.language||"ru",t=D[e],n=w("button","webhacker-button",{type:"button","aria-label":`${t.image} (${t.soon})`,"aria-disabled":"true","data-tooltip":t.soon}),o=w("i","fa-solid fa-image");return n.appendChild(o),n.disabled=!0,n},R.prototype.createSeparator=function(){return w("div","webhacker-toolbar__separator")},R.prototype.createDropdown=function(e,t){const n=w("div","webhacker-dropdown"),o=this.createToolbarButton(e,t,()=>{}),r=w("div","webhacker-menu webhacker-menu--hidden");return o.addEventListener("click",()=>{this.currentSavedSelectionRange=this.saveSelectionRange(),this.toggleMenu(r)}),n.append(o,r),{dropdownWrapperElement:n,dropdownMenuElement:r}},R.prototype.createToolbarButton=function(e,t,n,o=!1,r=null){const a=w("button","webhacker-button",{type:"button","aria-label":t,"data-tooltip":t}),i=w("i",e);return a.appendChild(i),a.addEventListener("mousedown",e=>e.preventDefault()),a.addEventListener("click",()=>{this.contentEditableElement.focus(),n(),this.emitChange(),this.syncToggleStates()}),o&&r&&(this.trackedToggleButtonsMap[r]=a),a};const N=["#6A5ACD","#2563EB","#22D3EE","#10B981","#84CC16","#F59E0B","#EF4444","#F472B6","#A855F7","#FB7185"],B={ru:_,en:M};R.prototype.createTableDropdown=function(){const e=this.editorOptions.language||"ru",t=B[e],{dropdownWrapperElement:n,dropdownMenuElement:o}=this.createDropdown("fa-solid fa-table",t.table),r=w("div","webhacker-tablepick"),a=w("div","webhacker-tablepick__label");a.textContent="0×0";const i=w("div","webhacker-tablepick__grid");for(let e=1;e<=10;e+=1)for(let t=1;t<=10;t+=1){const n=w("button","webhacker-tablepick__cell",{type:"button","data-row":String(e),"data-col":String(t),"aria-label":`${e}×${t}`});n.addEventListener("mouseenter",()=>{return n=e,o=t,a.textContent=`${n}×${o}`,void i.querySelectorAll(".webhacker-tablepick__cell").forEach(e=>{const t=parseInt(e.getAttribute("data-row"),10),r=parseInt(e.getAttribute("data-col"),10);t<=n&&r<=o?e.classList.add("is-selected"):e.classList.remove("is-selected")});var n,o}),n.addEventListener("click",()=>{this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange),this.insertMinimalTable(e,t),this.emitChange(),this.syncToggleStates()}),i.appendChild(n)}return r.append(a,i),o.appendChild(r),n},R.prototype.createHeadingDropdown=function(){const e=this.editorOptions.language||"ru",t=B[e],{dropdownWrapperElement:n,dropdownMenuElement:o}=this.createDropdown("fa-solid fa-heading",t.headings);return[{label:t.paragraph,tag:"p"},{label:"H1",tag:"h1"},{label:"H2",tag:"h2"},{label:"H3",tag:"h3"}].forEach(({label:e,tag:t})=>{const n=w("div","webhacker-menu__item");n.textContent=e,n.addEventListener("mousedown",e=>e.preventDefault()),n.addEventListener("click",()=>{this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange),L("formatBlock",t.toUpperCase()),this.emitChange(),this.syncToggleStates()}),o.appendChild(n)}),n},R.prototype.createColorDropdown=function(){const e=this.editorOptions.language||"ru",t=B[e],{dropdownWrapperElement:n,dropdownMenuElement:o}=this.createDropdown("fa-solid fa-palette",t.color),r=w("div","webhacker-color"),a=w("div","webhacker-color__swatches"),i=e=>{this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange),L("foreColor",e),this.emitChange(),this.syncToggleStates()};return N.forEach(e=>{const t=w("button","webhacker-swatch",{type:"button","data-color":e,title:e});t.style.background=e,t.addEventListener("click",()=>i(e)),a.appendChild(t)}),r.append(a),o.appendChild(r),n},R.prototype.createLinkDropdown=function(){const e=this.editorOptions.language||"ru",t=B[e],{dropdownWrapperElement:n,dropdownMenuElement:o}=this.createDropdown("fa-solid fa-link",t.link),r=w("div","webhacker-form"),a=w("input","webhacker-input",{type:"text",placeholder:t.linkPlaceholder}),i=w("input","webhacker-input",{type:"text",placeholder:t.linkTextPlaceholder}),l=w("div","webhacker-actions"),c=w("button","webhacker-button webhacker-button--primary",{type:"button"});c.textContent=t.ok;const s=w("button","webhacker-button webhacker-button--ghost",{type:"button"});return s.textContent=t.remove,l.append(c,s),r.append(a,i,l),o.appendChild(r),n.querySelector(".webhacker-button").addEventListener("click",()=>{const e=window.getSelection();let t=e&&e.anchorNode;t&&3===t.nodeType&&(t=t.parentNode);const n=t&&t.closest?t.closest("a"):null;a.value=n&&n.getAttribute("href")||"",i.value=n?n.textContent||"":e&&!e.isCollapsed?e.toString():""}),c.addEventListener("click",()=>{let e=a.value.trim();const t=i.value.trim();if(!e)return;e=x(e),this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange);const n=window.getSelection();if(!n||0===n.rangeCount)return;const o=n.isCollapsed?e:n.toString();L("insertHTML",`<a href="${e}" target="_blank" rel="noopener noreferrer">${y(t||o)}</a>`),this.emitChange(),this.syncToggleStates()}),s.addEventListener("click",()=>{this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange),L("unlink"),this.emitChange(),this.syncToggleStates(),a.value="",i.value=""}),n},R.prototype.insertMinimalTable=function(e=2,t=2){const n=document.createElement("table");n.className="wh-table";const o=document.createElement("tbody");for(let n=0;n<e;n+=1){const e=document.createElement("tr");for(let n=0;n<t;n+=1){const t=document.createElement("td");e.appendChild(t)}o.appendChild(e)}n.appendChild(o);const r=window.getSelection();if(r&&r.rangeCount){const e=r.getRangeAt(0);e.deleteContents(),e.insertNode(n)}else this.contentEditableElement.appendChild(n);const a=n.querySelector("tbody td");if(a){0===a.childNodes.length&&a.appendChild(document.createTextNode("​"));const e=a.firstChild,t=document.createRange();t.setStart(e,e.nodeValue.length),t.collapse(!0);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}},R.prototype.ensureCaretAnchorInTableCell=function(e,t=!1){if(!e)return;let n=e.firstChild;if(n&&3===n.nodeType?0===n.nodeValue.length&&(n.nodeValue="​"):(n=document.createTextNode("​"),e.insertBefore(n,e.firstChild||null)),t){const e=document.createRange();e.setStart(n,n.nodeValue.length),e.collapse(!0);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}},R.prototype.bindEditorEvents=function(){this.contentEditableElement.addEventListener("input",()=>{this.emitChange(),this.syncToggleStates()}),this.contentEditableElement.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData||window.clipboardData,n=t.getData("text/html"),o=t.getData("text/plain");if(n){const e=T(n,{stripColors:!0});document.execCommand("insertHTML",!1,e)}else if(o){const e=y(o).replace(/\r?\n/g,"<br>");document.execCommand("insertHTML",!1,e)}this.emitChange(),this.syncToggleStates()}),["mouseup","keyup"].forEach(e=>{this.contentEditableElement.addEventListener(e,()=>this.syncToggleStates())}),this.contentEditableElement.addEventListener("mousedown",e=>{const t=e.target&&e.target.closest?e.target.closest("td,th"):null;t&&this.ensureCaretAnchorInTableCell(t,!1)}),document.addEventListener("selectionchange",()=>{const e=window.getSelection();if(!e||0===e.rangeCount)return;const t=e.anchorNode&&3===e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode;if(t&&this.contentEditableElement.contains(t)){this.syncToggleStates();const e=t.closest&&t.closest("td,th");e&&this.ensureCaretAnchorInTableCell(e,!1)}}),this.contentEditableElement.addEventListener("keydown",e=>{const t=e.key.toLowerCase(),n=e.ctrlKey||e.metaKey;if("Enter"===e.key&&!e.shiftKey){const t=window.getSelection();if(t&&t.rangeCount){let n=t.anchorNode;n&&3===n.nodeType&&(n=n.parentNode);const o=n&&n.closest?n.closest("li"):null;if(o&&""===o.textContent.replace(/\u200B/g,"").trim())return e.preventDefault(),L("outdent"),this.emitChange(),void this.syncToggleStates()}}n&&"b"===t&&(e.preventDefault(),L("bold"),this.emitChange(),this.syncToggleStates()),n&&"i"===t&&(e.preventDefault(),L("italic"),this.emitChange(),this.syncToggleStates()),n&&"u"===t&&(e.preventDefault(),L("underline"),this.emitChange(),this.syncToggleStates()),n&&"z"===t&&!e.shiftKey&&(e.preventDefault(),L("undo"),this.emitChange(),this.syncToggleStates()),(n&&"y"===t||n&&e.shiftKey&&"z"===t)&&(e.preventDefault(),L("redo"),this.emitChange(),this.syncToggleStates())})};const O=R;return o})());