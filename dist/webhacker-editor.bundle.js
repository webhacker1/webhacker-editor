!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebHackerEditor=t():e.WebHackerEditor=t()}(self,()=>(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var a={},i=[],c=0;c<e.length;c++){var s=e[c],l=o.base?s[0]+o.base:s[0],d=a[l]||0,u="".concat(l," ").concat(d);a[l]=d+1;var p=n(u),h={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var b=r(h,o);o.byIndex=c,t.splice(c,0,{identifier:u,updater:b,references:1})}i.push(u)}return i}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var a=o(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=n(a[i]);t[c].references--}for(var s=o(e,r),l=0;l<a.length;l++){var d=n(a[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=s}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var c=0;c<this.length;c++){var s=this[c][0];null!=s&&(i[s]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);o&&i[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},584:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(601),r=n.n(o),a=n(314),i=n.n(a)()(r());i.push([e.id,':root {\n    --border-color: #e5e9f1;\n    --text-color: #0b1220;\n    --muted-color: #6b7280;\n    --accent-color: #2563eb;\n    --background-color: #f3f6fb;\n    --table-line: #afb0b3;\n}\n\n* {\n    box-sizing: border-box;\n}\n\n.webhacker-editor {\n    position: relative;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 14px;\n    overflow: hidden;\n    color: var(--text-color);\n}\n\n.webhacker-toolbar {\n    display: flex;\n    gap: 8px;\n    padding: 10px;\n    background: var(--background-color);\n    border-bottom: 1px solid var(--border-color);\n    border-radius: 14px;\n    align-items: center;\n    flex-wrap: wrap;\n    color: var(--text-color);\n    z-index: 1;\n}\n\n.webhacker-toolbar__group {\n    display: flex;\n    gap: 6px;\n    align-items: center;\n}\n\n.webhacker-toolbar__separator {\n    width: 1px;\n    height: 24px;\n    background: var(--border-color);\n}\n\n.webhacker-button {\n    appearance: none;\n    border: 1px solid var(--border-color);\n    background: var(--background-color);\n    color: var(--text-color);\n    padding: 6px 8px;\n    border-radius: 10px;\n    cursor: pointer;\n}\n.webhacker-button:hover {\n    background: var(--background-color);\n}\n.webhacker-button[aria-pressed="true"] {\n    outline: 2px solid var(--accent-color);\n    outline-offset: 1px;\n}\n.webhacker-button--primary,\n.webhacker-button--primary:hover {\n    background: var(--accent-color);\n    border-color: transparent;\n    color: #fff;\n}\n.webhacker-button--ghost {\n    background: transparent;\n}\n\n.webhacker-button[disabled],\n.webhacker-button[aria-disabled="true"] {\n    cursor: not-allowed;\n    position: relative;\n}\n\n.webhacker-button[disabled] > i,\n.webhacker-button[aria-disabled="true"] > i {\n    opacity: 0.5;\n}\n\n.webhacker-button[disabled]:hover,\n.webhacker-button[aria-disabled="true"]:hover {\n    background: var(--background-color);\n}\n.webhacker-button[aria-disabled="true"]::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    top: calc(100% + 6px);\n    left: 50%;\n    transform: translateX(-50%);\n    background: #1e2251;\n    color: #fff;\n    padding: 4px 6px;\n    border-radius: 6px;\n    font-size: 12px;\n    white-space: nowrap;\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.15s ease;\n    z-index: 30;\n}\n.webhacker-button[aria-disabled="true"]:hover::after {\n    opacity: 1;\n}\n\n.webhacker-dropdown {\n    position: relative;\n}\n\n.webhacker-menu {\n    position: absolute;\n    top: 40px;\n    left: 0;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 12px;\n    padding: 8px;\n    z-index: 20;\n    color: var(--text-color);\n}\n.webhacker-menu--hidden {\n    display: none;\n}\n.webhacker-menu__item {\n    padding: 8px 10px;\n    border-radius: 8px;\n    cursor: pointer;\n}\n.webhacker-menu__item:hover {\n    background: var(--background-color);\n}\n\n.webhacker-content {\n    min-height: 320px;\n    padding: 18px;\n    outline: none;\n    color: var(--text-color);\n}\n.webhacker-content:empty:before {\n    content: attr(data-placeholder);\n    color: var(--muted-color);\n}\n\n.webhacker-toolbar--fixed + .webhacker-content {\n    padding-top: var(--toolbar-height, 50px);\n}\n\n.webhacker-content p {\n    margin: 0 0 10px;\n}\n\n.webhacker-content a {\n    color: var(--accent-color);\n    text-decoration: none;\n    border-bottom: 1px solid rgba(37, 99, 235, 0.35);\n}\n.webhacker-content a:hover {\n    border-bottom-color: currentColor;\n}\n\n.webhacker-content strong,\n.webhacker-content b {\n    font-weight: 700;\n}\n.webhacker-content em,\n.webhacker-content i {\n    font-style: italic;\n}\n.webhacker-content u {\n    text-decoration: underline;\n}\n\n.webhacker-content img {\n    max-width: 100%;\n    border-radius: 10px;\n    display: block;\n    height: auto;\n    margin: 12px 0;\n}\n\n.webhacker-content h1,\n.webhacker-content h2,\n.webhacker-content h3,\n.webhacker-content h4,\n.webhacker-content h5,\n.webhacker-content h6 {\n    line-height: 1.25;\n    font-weight: 700;\n    color: var(--text-color);\n}\n.webhacker-content h1 {\n    font-size: 32px;\n    letter-spacing: -0.01em;\n}\n.webhacker-content h2 {\n    font-size: 26px;\n}\n.webhacker-content h3 {\n    font-size: 22px;\n}\n.webhacker-content h4 {\n    font-size: 18px;\n}\n.webhacker-content h5 {\n    font-size: 16px;\n}\n.webhacker-content h6 {\n    font-size: 14px;\n    color: var(--muted-color);\n    text-transform: uppercase;\n    letter-spacing: 0.06em;\n}\n\n.webhacker-content ul,\n.webhacker-content ol {\n    margin: 0 0 1em 1.4em;\n    padding: 0;\n}\n.webhacker-content li {\n    margin: 0.3em 0;\n}\n\n.webhacker-content blockquote {\n    margin: 1.2em 0;\n    padding: 0.6em 0.9em 0.6em 1em;\n    background: #f8fafc;\n    border-left: 4px solid #cbd5e1;\n    border-radius: 8px;\n    color: #334155;\n}\n\n.webhacker-color {\n    display: flex;\n    gap: 10px;\n    flex-wrap: nowrap;\n    flex-direction: row;\n    align-items: center;\n}\n.webhacker-color__swatches {\n    display: grid;\n    grid-template-columns: repeat(5, 18px);\n    gap: 6px;\n}\n.webhacker-swatch {\n    width: 18px;\n    height: 18px;\n    border-radius: 4px;\n    border: 1px solid var(--border-color);\n    cursor: pointer;\n}\n.webhacker-swatch[aria-selected="true"] {\n    outline: 2px solid var(--accent-color);\n}\n\n.webhacker-input,\n.webhacker-file {\n    padding: 8px;\n    width: 180px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    background: var(--background-color);\n    color: var(--text-color);\n}\n\n.webhacker-form {\n    display: grid;\n    gap: 8px;\n}\n.webhacker-actions {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-end;\n}\n\n.webhacker-tablepick {\n    display: grid;\n    gap: 8px;\n}\n.webhacker-tablepick__label {\n    font-size: 12px;\n    color: var(--muted-color);\n    text-align: right;\n}\n.webhacker-tablepick__grid {\n    display: grid;\n    grid-template-columns: repeat(10, 18px);\n    gap: 6px;\n}\n.webhacker-tablepick__cell {\n    width: 18px;\n    height: 18px;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    background: var(--background-color);\n    padding: 0;\n    cursor: pointer;\n}\n.webhacker-tablepick__cell.is-selected {\n    background: var(--accent-color);\n    border-color: var(--accent-color);\n}\n\n.webhacker-badge--beta {\n    display: inline-block;\n    margin-left: 6px;\n    padding: 4px 8px;\n    font-size: 0.8rem;\n    border-radius: 4px;\n    background: #fea530;\n    color: #fff;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.wh-table {\n    display: inline-table;\n    border-collapse: separate;\n    border-spacing: 0;\n    background: var(--background-color);\n    color: var(--text-color);\n    border: 2px solid var(--table-line);\n    border-radius: 10px;\n    overflow: hidden;\n    margin: 16px auto;\n    max-width: 100%;\n}\n.wh-table th,\n.wh-table td {\n    padding: 10px 14px;\n    vertical-align: top;\n    border-right: 1px solid var(--table-line);\n    border-bottom: 1px solid var(--table-line);\n    word-break: break-word;\n}\n.wh-table thead th {\n    font-weight: 600;\n    border-bottom: 2px solid var(--table-line);\n}\n.wh-table th:last-child,\n.wh-table td:last-child {\n    border-right: 0;\n}\n.wh-table tr:last-child td {\n    border-bottom: 0;\n}\n.wh-table + .wh-table {\n    margin-top: 20px;\n}\n\n.webhacker-button[data-tooltip] {\n    position: relative;\n}\n.webhacker-button[data-tooltip]:not([aria-disabled="true"])::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    top: calc(100% + 6px);\n    left: 50%;\n    transform: translate(-50%, -4px);\n    background: #1e2251;\n    color: #fff;\n    padding: 4px 6px;\n    border-radius: 6px;\n    font-size: 12px;\n    white-space: nowrap;\n    opacity: 0;\n    pointer-events: none;\n    transition:\n        opacity 0.15s ease,\n        transform 0.15s ease;\n    z-index: 30;\n}\n.webhacker-button[data-tooltip]:hover::after,\n.webhacker-button[data-tooltip]:focus-visible::after {\n    opacity: 1;\n    transform: translate(-50%, 0);\n}\n\n.webhacker-content {\n    position: relative;\n}\n\n.webhacker-toolbar--fixed {\n    position: fixed;\n    top: 0;\n    right: 0;\n    margin: 1vh 2vw;\n    background: var(--secondary-color);\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n/* Единый стиль для фокуса во всех меню */\n.webhacker-menu__item:focus,\n.webhacker-swatch:focus,\n.webhacker-tablepick__cell:focus,\n.webhacker-button--ghost:focus {\n    outline: none;\n}\n\n.webhacker-menu__item.is-focused,\n.webhacker-swatch.is-focused,\n.webhacker-tablepick__cell.is-focused,\n.webhacker-button--ghost.is-focused {\n    outline: 2px solid var(--primary-color, #007bff);\n    outline-offset: 2px;\n    position: relative;\n    z-index: 1;\n}\n\n/* Специфичные стили для разных типов элементов */\n.webhacker-menu__item.is-focused {\n    background-color: rgba(0, 123, 255, 0.1);\n}\n\n.webhacker-swatch.is-focused {\n    transform: scale(1.1);\n    box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color, #007bff);\n}\n\n.webhacker-tablepick__cell.is-focused.is-selected {\n    background-color: var(--primary-color, #007bff);\n}\n\n.webhacker-button--ghost.is-focused {\n    background-color: rgba(0, 123, 255, 0.1);\n}\n',""]);const c=i},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={id:o,exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var o={};n.r(o),n.d(o,{default:()=>H,sanitizeHtmlStringToSafeHtml:()=>A});var r=n(72),a=n.n(r),i=n(825),c=n.n(i),s=n(659),l=n.n(s),d=n(56),u=n.n(d),p=n(540),h=n.n(p),b=n(113),g=n.n(b),f=n(584),m={};function w(e,t,n){const o=document.createElement(e);return t&&(o.className=t),n&&Object.entries(n).forEach(([e,t])=>o.setAttribute(e,t)),o}m.styleTagTransform=g(),m.setAttributes=u(),m.insert=l().bind(null,"head"),m.domAPI=c(),m.insertStyleElement=h(),a()(f.A,m),f.A&&f.A.locals&&f.A.locals;const k=new Set(["p","br","hr","strong","b","em","i","u","mark","small","sub","sup","span","font","a","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","figure","figcaption","dl","dt","dd","img","table","thead","tbody","tr","th","td","div"]),v=["wh-table"];function x(e){return String(e).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}function y(e){const t=String(e||"").trim();if(/^(https?:|mailto:|tel:|data:image\/)/i.test(t))return t;const n=t.replace(/^[a-zA-Z][\w+.-]*:/,"");return n?"https://"+n:"https://"}function E(e){const t=String(e||"").trim();if(/^#([0-9a-fA-F]{3}){1,2}$/.test(t))return 4===t.length?("#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]).toUpperCase():t.toUpperCase();const n=t.match(/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*[\d.]+\s*)?\)$/);if(n){const e=e=>Math.max(0,Math.min(255,parseInt(e,10))),t=t=>e(t).toString(16).padStart(2,"0");return("#"+t(n[1])+t(n[2])+t(n[3])).toUpperCase()}return null}function C(e,t={}){if(!e.hasAttribute("style"))return;const n=!!t.stripColors,o=e.tagName.toLowerCase(),r=(e.getAttribute("style")||"").split(";").map(e=>e.trim()).filter(Boolean),a=new Set(["p","div","blockquote","li","td","th","h1","h2","h3","h4","h5","h6"]);let i=null,c=null;for(const e of r){const t=e.split(":"),r=t[0]?t[0].trim().toLowerCase():"",s=t[1]?t[1].trim():"";if(!n&&"color"===r&&"span"===o){const e=E(s);e&&(i=e)}if(!/^background(-color)?$/.test(r)&&"text-align"===r&&a.has(o)){const e=s.toLowerCase();"left"!==e&&"right"!==e&&"center"!==e&&"justify"!==e||(c=e)}}const s=[];i&&s.push(`color: ${i}`),c&&s.push(`text-align: ${c}`),s.length?e.setAttribute("style",s.join("; ")):e.removeAttribute("style")}function T(e,t={}){if(e.nodeType!==Node.COMMENT_NODE)if(e.nodeType===Node.ELEMENT_NODE){const n=e.tagName.toLowerCase();if(!k.has(n)){const t=document.createTextNode(e.textContent||"");return void e.replaceWith(t)}!function(e,t={}){[...e.attributes].filter(e=>/^on/i.test(e.name)).forEach(t=>e.removeAttribute(t.name));const n=e.tagName.toLowerCase();e.removeAttribute("id");const o=e.getAttribute("style");if(o){const t=o.split(";").map(e=>e.trim()).filter(e=>e&&!/^font-family\s*:/i.test(e)).join("; ");t?e.setAttribute("style",t):e.removeAttribute("style")}switch(n){case"a":{const n=y(e.getAttribute("href")||"");e.setAttribute("href",n),e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"),[...e.attributes].forEach(t=>{["href","target","rel","style"].includes(t.name)||e.removeAttribute(t.name)}),C(e,t);break}case"img":{const t=y(e.getAttribute("src")||""),n=/^data:image\//i.test(t),o=/^https?:\/\//i.test(t)&&/\.(png|jpe?g|gif|webp|svg)$/i.test(t);if(!n&&!o){e.remove();break}e.setAttribute("src",t);const r=e.getAttribute("alt")||"";e.setAttribute("alt",r),[...e.attributes].forEach(t=>{["src","alt"].includes(t.name)||e.removeAttribute(t.name)});break}case"span":default:C(e,t),[...e.attributes].forEach(t=>{["style"].includes(t.name)||e.removeAttribute(t.name)});break;case"font":{e.removeAttribute("face");const n=t.stripColors?null:E(e.getAttribute("color"));n?e.setAttribute("color",n):e.removeAttribute("color"),[...e.attributes].forEach(t=>{["color"].includes(t.name)||e.removeAttribute(t.name)});break}case"table":{const t=(e.getAttribute("class")||"").split(/\s+/).filter(e=>v.includes(e));t.length?e.setAttribute("class",t.join(" ")):e.removeAttribute("class"),[...e.attributes].forEach(t=>{["class"].includes(t.name)||e.removeAttribute(t.name)});break}case"td":case"th":{const n=(e.getAttribute("class")||"").split(/\s+/).filter(e=>"is-numeric"===e);n.length?e.setAttribute("class",n.join(" ")):e.removeAttribute("class");const o=e.getAttribute("colspan"),r=e.getAttribute("rowspan");[...e.attributes].forEach(t=>{["class","colspan","rowspan","style"].includes(t.name)||e.removeAttribute(t.name)}),o&&!/^\d+$/.test(o)&&e.removeAttribute("colspan"),r&&!/^\d+$/.test(r)&&e.removeAttribute("rowspan"),C(e,t);break}}}(e,t),[...e.childNodes].forEach(e=>T(e,t))}else[...e.childNodes||[]].forEach(e=>T(e,t));else e.remove()}function A(e,t={}){const n=document.createElement("template");return n.innerHTML=String(e||""),T(n.content,t),n.innerHTML}function L(e,t){t&&(t.backgroundColor&&e.style.setProperty("--editor-background",t.backgroundColor),t.textColor&&e.style.setProperty("--text-color",t.textColor))}function S(e,t=null){document.execCommand(e,!1,t)}const _={placeholder:"Начните печатать…",undo:"Отменить",redo:"Повторить",bold:"Жирный",italic:"Курсив",underline:"Подчеркнуть",color:"Цвет текста",reset_styles:"Сбросить стили",link:"Ссылка",image:"Изображение",headings:"Заголовки",table:"Таблица",unorderedList:"Маркированный список",orderedList:"Нумерованный список",alignLeft:"По левому краю",alignCenter:"По центру",alignRight:"По правому краю",beta:"БЕТА",soon:"Скоро",remove:"Удалить",ok:"OK",paragraph:"Абзац",linkPlaceholder:"https://пример.ру",linkTextPlaceholder:"Текст ссылки (необязательно)",clearColor:"Стереть цвет"},M={placeholder:"Start typing…",undo:"Undo",redo:"Redo",bold:"Bold",italic:"Italic",underline:"Underline",color:"Text color",reset_styles:"Reset styles",link:"Link",image:"Image",headings:"Headings",table:"Table",unorderedList:"Bulleted list",orderedList:"Numbered list",alignLeft:"Align left",alignCenter:"Center",alignRight:"Align right",beta:"BETA",soon:"Soon",remove:"Remove",ok:"OK",paragraph:"Paragraph",linkPlaceholder:"https://example.com",linkTextPlaceholder:"Link text (optional)",clearColor:"Clear color"};function R(e,t={}){if(this.hostContainerElement="string"==typeof e?document.querySelector(e):e,!this.hostContainerElement)throw new Error("WebHackerEditor: контейнер не найден");this.editorOptions=Object.assign({},{language:"ru",placeholderText:null,onChange:null,theme:null},t),this.currentSavedSelectionRange=null,this.trackedToggleButtonsMap={},this.renderEditorInterface(),L(this.editorRootElement,this.editorOptions.theme),this.bindEditorEvents()}R.prototype.getHTML=function(){return A(this.contentEditableElement.innerHTML).trim()},R.prototype.setHTML=function(e){const t=A(e);this.contentEditableElement.innerHTML=t||"",this.syncToggleStates()},R.prototype.renderEditorInterface=function(){const e={ru:_,en:M}[this.editorOptions.language||"ru"],t=w("div","webhacker-editor",{role:"region"}),n=w("div","webhacker-toolbar"),o=w("div","webhacker-toolbar__group");o.append(this.createToolbarButton("fa-solid fa-rotate-left",e.undo,()=>S("undo")),this.createToolbarButton("fa-solid fa-rotate-right",e.redo,()=>S("redo")));const r=w("div","webhacker-toolbar__group");r.append(this.createToolbarButton("fa-solid fa-bold",e.bold,()=>S("bold"),!0,"bold"),this.createToolbarButton("fa-solid fa-italic",e.italic,()=>S("italic"),!0,"italic"),this.createToolbarButton("fa-solid fa-underline",e.underline,()=>S("underline"),!0,"underline"),this.createColorDropdown(),this.createLinkDropdown(),this.createDisabledImageButton());const a=w("div","webhacker-toolbar__group");a.append(this.createHeadingDropdown());const i=w("div","webhacker-toolbar__group");i.append(this.createToolbarButton("fa-solid fa-align-left",e.alignLeft,()=>S("justifyLeft"),!0,"alignLeft"),this.createToolbarButton("fa-solid fa-align-center",e.alignCenter,()=>S("justifyCenter"),!0,"alignCenter"),this.createToolbarButton("fa-solid fa-align-right",e.alignRight,()=>S("justifyRight"),!0,"alignRight"));const c=w("div","webhacker-toolbar__group");c.append(this.createToolbarButton("fa-solid fa-list-ul",e.unorderedList,()=>S("insertUnorderedList"),!0,"unorderedList"),this.createToolbarButton("fa-solid fa-list-ol",e.orderedList,()=>S("insertOrderedList"),!0,"orderedList"),this.createTableDropdown());const s=w("div","webhacker-toolbar__group");s.append(this.createToolbarButton("fa-solid fa-eraser",e.reset_styles,()=>S("removeFormat"),!0,"reset styles")),n.append(o,this.createSeparator(),r,this.createSeparator(),a,this.createSeparator(),i,this.createSeparator(),c,this.createSeparator(),s);const l=w("span","webhacker-badge--beta",{title:e.soon});l.textContent=e.beta,n.append(l);const d=w("div","webhacker-content",{contenteditable:"true"});d.setAttribute("data-placeholder",this.editorOptions.placeholderText||e.placeholder),t.append(n,d),this.hostContainerElement.appendChild(t),this.editorRootElement=t,this.toolbarElement=n,this.contentEditableElement=d,this.setupToolbarSticky()},R.prototype.setupToolbarSticky=function(){const e=this.toolbarElement,t=this.editorRootElement;if(!e||!t)return;t.style.setProperty("--toolbar-height",e.offsetHeight+"px");const n=()=>{t.getBoundingClientRect().top<0?e.classList.add("webhacker-toolbar--fixed"):e.classList.remove("webhacker-toolbar--fixed")};window.addEventListener("scroll",n),this.toolbarScrollHandler=n,n()},R.prototype.toggleMenu=function(e){this.closeAllMenus(e),e.classList.toggle("webhacker-menu--hidden"),e.style.left="unset",e.style.right="unset",e.classList.contains("webhacker-menu--hidden")||setTimeout(()=>{e.getBoundingClientRect().right>this.editorRootElement.getBoundingClientRect().right&&(e.style.left="unset",e.style.right="0")},0);const t=n=>{e.contains(n.target)||(this.closeAllMenus(),document.removeEventListener("mousedown",t,!0))};document.addEventListener("mousedown",t,!0)},R.prototype.closeAllMenus=function(e){this.editorRootElement.querySelectorAll(".webhacker-menu").forEach(t=>{t!==e&&t.classList.add("webhacker-menu--hidden")})},R.prototype.emitChange=function(){"function"==typeof this.editorOptions.onChange&&this.editorOptions.onChange(this.getHTML())},R.prototype.syncToggleStates=function(){const e=e=>String(document.queryCommandState(e)),t=(e,t)=>{this.trackedToggleButtonsMap[e]&&this.trackedToggleButtonsMap[e].setAttribute("aria-pressed",t)};t("bold",e("bold")),t("italic",e("italic")),t("underline",e("underline")),t("unorderedList",e("insertUnorderedList")),t("orderedList",e("insertOrderedList")),t("alignLeft",e("justifyLeft")),t("alignCenter",e("justifyCenter")),t("alignRight",e("justifyRight"))},R.prototype.saveSelectionRange=function(){const e=window.getSelection();return e&&0!==e.rangeCount?e.getRangeAt(0).cloneRange():null},R.prototype.restoreSelectionRange=function(e){if(!e)return;const t=window.getSelection();t.removeAllRanges(),t.addRange(e)},R.prototype.setTheme=function(e){L(this.editorRootElement,e||null)},R.prototype.createMenuAction=function(e){return t=>{t&&(t.preventDefault(),t.stopPropagation());const n=window.scrollY;this.closeAllMenus(),this.contentEditableElement.focus(),this.restoreSelectionRange(this.currentSavedSelectionRange),e&&e(),this.emitChange(),this.syncToggleStates(),window.scrollTo(0,n)}};const D={ru:_,en:M};R.prototype.createDisabledImageButton=function(){const e=this.editorOptions.language||"ru",t=D[e],n=w("button","webhacker-button",{type:"button","aria-label":`${t.image} (${t.soon})`,"aria-disabled":"true","data-tooltip":t.soon}),o=w("i","fa-solid fa-image");return n.appendChild(o),n.disabled=!0,n},R.prototype.createSeparator=function(){return w("div","webhacker-toolbar__separator")},R.prototype.createDropdown=function(e,t){const n=w("div","webhacker-dropdown"),o=this.createToolbarButton(e,t,()=>{}),r=w("div","webhacker-menu webhacker-menu--hidden");return o.addEventListener("click",()=>{this.currentSavedSelectionRange=this.saveSelectionRange(),this.toggleMenu(r)}),n.append(o,r),{dropdownWrapperElement:n,dropdownMenuElement:r}},R.prototype.createToolbarButton=function(e,t,n,o=!1,r=null){const a=w("button","webhacker-button",{type:"button","aria-label":t,"data-tooltip":t}),i=w("i",e);return a.appendChild(i),a.addEventListener("mousedown",e=>e.preventDefault()),a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=window.scrollY;this.contentEditableElement.focus(),n(),this.emitChange(),this.syncToggleStates(),window.scrollTo(0,t)}),o&&r&&(this.trackedToggleButtonsMap[r]=a),a};const N=["#6A5ACD","#2563EB","#22D3EE","#10B981","#84CC16","#F59E0B","#EF4444","#F472B6","#A855F7","#FB7185"],B={ru:_,en:M};R.prototype.setupMenuKeyboardNav=function(e,t={}){const{items:n,onSelect:o,onClose:r,focusFirst:a=!0,grid:i=null}=t;if(!e||!n?.length)return;let c=0;const s=!!i,l=i?.cols||1,d=e=>{if(e=(e+n.length)%n.length,c=e,n.forEach((t,n)=>{t.tabIndex=n===e?0:-1,t.classList.toggle("is-focused",n===e)}),n[c]?.focus(),s&&i?.onHover){const{row:e,col:t}=n[c].dataset;i.onHover(+e,+t)}},u=()=>{e.classList.add("webhacker-menu--hidden"),n.forEach(e=>{e.tabIndex=-1,e.classList.remove("is-focused")}),r?.(),e.closest(".webhacker-dropdown")?.querySelector(".webhacker-button")?.focus(),e.closest(".webhacker-dropdown")?.dispatchEvent(new Event("dropdownClosed"))};n.forEach((e,t)=>{e.addEventListener("keydown",e=>{const t=e.key;(t.startsWith("Arrow")||"Tab"===t)&&e.preventDefault(),s?("ArrowRight"===t&&d(c+1),"ArrowLeft"===t&&d(c-1),"ArrowDown"===t&&d(c+l),"ArrowUp"===t&&d(c-l),"Tab"===t&&d(c+(e.shiftKey?-1:1))):("ArrowRight"!==t&&"ArrowDown"!==t||d(c+1),"ArrowLeft"!==t&&"ArrowUp"!==t||d(c-1),"Tab"===t&&d(c+(e.shiftKey?-1:1))),"Enter"!==t&&" "!==t||(e.preventDefault(),o?.(n[c]),u()),"Escape"===t&&u()}),e.addEventListener("mouseenter",()=>d(t)),e.addEventListener("click",()=>{d(t),o?.(e),u()})});const p=e.closest(".webhacker-dropdown")?.querySelector(".webhacker-button");return p?.addEventListener("click",()=>{a&&setTimeout(()=>{e.classList.contains("webhacker-menu--hidden")||d(0)},50)}),e.closest(".webhacker-dropdown")?.addEventListener("dropdownClosed",()=>{c=0,n.forEach(e=>{e.tabIndex=-1,e.classList.remove("is-focused")}),r?.()}),{focus:d,close:u}},R.prototype.createTableDropdown=function(){const{dropdownWrapperElement:e,dropdownMenuElement:t}=this.createDropdown("fa-solid fa-table",B[this.editorOptions.language||"ru"].table),n=w("div","webhacker-tablepick"),o=w("div","webhacker-tablepick__label");o.textContent="0×0";const r=w("div","webhacker-tablepick__grid");let a=0,i=0;const c=[];for(let e=1;e<=10;e++)for(let t=1;t<=10;t++){const n=w("button","webhacker-tablepick__cell",{type:"button","data-row":e,"data-col":t,"aria-label":`${e}×${t}`,tabindex:"-1"});n.addEventListener("click",this.createMenuAction(()=>this.insertMinimalTable(a,i))),r.appendChild(n),c.push(n)}return n.append(o,r),t.appendChild(n),this.setupMenuKeyboardNav(t,{items:c,grid:{cols:10,onHover:(e,t)=>{a=e,i=t,o.textContent=`${e}×${t}`,c.forEach(n=>{const{row:o,col:r}=n.dataset;n.classList.toggle("is-selected",+o<=e&&+r<=t)})}},onSelect:()=>this.insertMinimalTable(a,i),onClose:()=>{a=i=0,o.textContent="0×0",c.forEach(e=>e.classList.remove("is-selected"))}}),e},R.prototype.createHeadingDropdown=function(){const e=B[this.editorOptions.language||"ru"],{dropdownWrapperElement:t,dropdownMenuElement:n}=this.createDropdown("fa-solid fa-heading",e.headings),o=[{label:e.paragraph,tag:"p"},{label:"H1",tag:"h1"},{label:"H2",tag:"h2"},{label:"H3",tag:"h3"}],r=o.map(({label:e,tag:t})=>{const o=w("div","webhacker-menu__item");return o.textContent=e,o.tabIndex="-1",o.addEventListener("mousedown",e=>e.preventDefault()),o.addEventListener("click",this.createMenuAction(()=>S("formatBlock",t.toUpperCase()))),n.appendChild(o),o});return this.setupMenuKeyboardNav(n,{items:r,onSelect:e=>S("formatBlock",o[r.indexOf(e)].tag.toUpperCase())}),t},R.prototype.createColorDropdown=function(){const e=B[this.editorOptions.language||"ru"],{dropdownWrapperElement:t,dropdownMenuElement:n}=this.createDropdown("fa-solid fa-palette",e.color),o=w("div","webhacker-color"),r=w("div","webhacker-color__swatches"),a=N.map(e=>{const t=w("button","webhacker-swatch",{type:"button","data-color":e,title:e,tabindex:"-1"});return t.style.background=e,t.addEventListener("click",this.createMenuAction(()=>S("foreColor",e))),r.appendChild(t),t}),i=w("button","webhacker-button webhacker-button--ghost",{type:"button","data-tooltip":e.clearColor,tabindex:"-1"});i.innerHTML='<i class="fa-solid fa-eraser"></i>',i.addEventListener("click",this.createMenuAction(()=>{S("foreColor",getComputedStyle(this.editorRootElement).getPropertyValue("--text-color").trim())})),o.append(r,i),n.appendChild(o);const c=[...a,i];return this.setupMenuKeyboardNav(n,{items:c,onSelect:e=>{S("foreColor",e===i?getComputedStyle(this.editorRootElement).getPropertyValue("--text-color").trim():e.dataset.color)}}),t},R.prototype.createLinkDropdown=function(){const e=this.editorOptions.language||"ru",t=B[e],{dropdownWrapperElement:n,dropdownMenuElement:o}=this.createDropdown("fa-solid fa-link",t.link),r=w("div","webhacker-form"),a=w("input","webhacker-input",{type:"text",placeholder:t.linkPlaceholder}),i=w("input","webhacker-input",{type:"text",placeholder:t.linkTextPlaceholder}),c=w("div","webhacker-actions"),s=w("button","webhacker-button webhacker-button--primary",{type:"button"});s.textContent=t.ok;const l=w("button","webhacker-button webhacker-button--ghost",{type:"button"});return l.textContent=t.remove,c.append(s,l),r.append(a,i,c),o.appendChild(r),n.querySelector(".webhacker-button").addEventListener("click",()=>{const e=window.getSelection();let t=e&&e.anchorNode;t&&3===t.nodeType&&(t=t.parentNode);const n=t&&t.closest?t.closest("a"):null;a.value=n&&n.getAttribute("href")||"",i.value=n?n.textContent||"":e&&!e.isCollapsed?e.toString():""}),s.addEventListener("click",this.createMenuAction(()=>{let e=a.value.trim();const t=i.value.trim();if(!e)return;e=y(e);const n=window.getSelection();if(!n||0===n.rangeCount)return;const o=n.isCollapsed?e:n.toString();S("insertHTML",`<a href="${e}" target="_blank" rel="noopener noreferrer">${x(t||o)}</a>`)})),l.addEventListener("click",this.createMenuAction(()=>{S("unlink"),a.value="",i.value=""})),n},R.prototype.insertMinimalTable=function(e=2,t=2){const n=document.createElement("table");n.className="wh-table";const o=document.createElement("tbody");for(let n=0;n<e;n+=1){const e=document.createElement("tr");for(let n=0;n<t;n+=1){const t=document.createElement("td");e.appendChild(t)}o.appendChild(e)}n.appendChild(o);const r=window.getSelection();if(r&&r.rangeCount){const e=r.getRangeAt(0);e.deleteContents(),e.insertNode(n)}else this.contentEditableElement.appendChild(n);const a=n.querySelector("tbody td");if(a){0===a.childNodes.length&&a.appendChild(document.createTextNode("​"));const e=a.firstChild,t=document.createRange();t.setStart(e,e.nodeValue.length),t.collapse(!0);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}},R.prototype.ensureCaretAnchorInTableCell=function(e,t=!1){if(!e)return;let n=e.firstChild;if(n&&3===n.nodeType?0===n.nodeValue.length&&(n.nodeValue="​"):(n=document.createTextNode("​"),e.insertBefore(n,e.firstChild||null)),t){const e=document.createRange();e.setStart(n,n.nodeValue.length),e.collapse(!0);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}},R.prototype.bindEditorEvents=function(){this.contentEditableElement.addEventListener("input",()=>{this.emitChange(),this.syncToggleStates()}),this.contentEditableElement.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData||window.clipboardData,n=t.getData("text/html"),o=t.getData("text/plain");if(n){const e=A(n,{stripColors:!0});document.execCommand("insertHTML",!1,e)}else if(o){const e=x(o).replace(/\r?\n/g,"<br>");document.execCommand("insertHTML",!1,e)}this.emitChange(),this.syncToggleStates()}),["mouseup","keyup"].forEach(e=>{this.contentEditableElement.addEventListener(e,()=>this.syncToggleStates())}),this.contentEditableElement.addEventListener("mousedown",e=>{const t=e.target&&e.target.closest?e.target.closest("td,th"):null;t&&this.ensureCaretAnchorInTableCell(t,!1)}),document.addEventListener("selectionchange",()=>{const e=window.getSelection();if(!e||0===e.rangeCount)return;const t=e.anchorNode&&3===e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode;if(t&&this.contentEditableElement.contains(t)){this.syncToggleStates();const e=t.closest&&t.closest("td,th");e&&this.ensureCaretAnchorInTableCell(e,!1)}}),this.contentEditableElement.addEventListener("keydown",e=>{const t=e.key.toLowerCase(),n=e.ctrlKey||e.metaKey;if("Enter"===e.key&&!e.shiftKey){const t=window.getSelection();if(t&&t.rangeCount){let n=t.anchorNode;n&&3===n.nodeType&&(n=n.parentNode);const o=n&&n.closest?n.closest("li"):null;if(o&&""===o.textContent.replace(/\u200B/g,"").trim())return e.preventDefault(),S("outdent"),this.emitChange(),void this.syncToggleStates()}}n&&"b"===t&&(e.preventDefault(),S("bold"),this.emitChange(),this.syncToggleStates()),n&&"i"===t&&(e.preventDefault(),S("italic"),this.emitChange(),this.syncToggleStates()),n&&"u"===t&&(e.preventDefault(),S("underline"),this.emitChange(),this.syncToggleStates()),n&&"z"===t&&!e.shiftKey&&(e.preventDefault(),S("undo"),this.emitChange(),this.syncToggleStates()),(n&&"y"===t||n&&e.shiftKey&&"z"===t)&&(e.preventDefault(),S("redo"),this.emitChange(),this.syncToggleStates())})};const H=R;return o})());